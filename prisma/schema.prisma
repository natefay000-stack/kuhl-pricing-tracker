generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Products from Line List
model Product {
  id                      String   @id @default(cuid())
  styleNumber             String
  styleDesc               String?
  color                   String?
  colorDesc               String?
  styleColor              String?
  season                  String
  seasonType              String?
  divisionDesc            String?
  categoryDesc            String?
  category                String?
  productLine             String?
  productLineDesc         String?
  labelDesc               String?
  designerName            String?
  techDesignerName        String?
  countryOfOrigin         String?
  factoryName             String?
  msrp                    Float    @default(0)
  price                   Float    @default(0)
  cost                    Float    @default(0)
  cadMsrp                 Float?
  cadPrice                Float?
  carryOver               Boolean  @default(false)
  carryForward            Boolean  @default(false)
  sellingSeasons          String?
  htsCode                 String?
  styleColorNotes         String?
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  @@unique([styleNumber, color, season])
  @@index([season])
  @@index([styleNumber])
  @@index([divisionDesc])
  @@index([categoryDesc])
}

// Sales data
model Sale {
  id                String   @id @default(cuid())
  styleNumber       String
  styleDesc         String?
  colorCode         String?
  colorDesc         String?
  season            String
  seasonType        String?
  customer          String?
  customerType      String?
  salesRep          String?
  divisionDesc      String?
  categoryDesc      String?
  gender            String?
  unitsBooked       Int      @default(0)
  unitsOpen         Int      @default(0)
  revenue           Float    @default(0)
  shipped           Float    @default(0)
  cost              Float    @default(0)
  wholesalePrice    Float    @default(0)
  msrp              Float    @default(0)
  netUnitPrice      Float    @default(0)
  orderType         String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([season])
  @@index([styleNumber])
  @@index([customer])
  @@index([customerType])
}

// Pricing by season (from pricebyseason file)
model Pricing {
  id          String   @id @default(cuid())
  styleNumber String
  styleDesc   String?
  colorCode   String?
  colorDesc   String?
  season      String
  seasonType  String?
  seasonDesc  String?
  price       Float    @default(0)
  msrp        Float    @default(0)
  cost        Float    @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([styleNumber, colorCode, season])
  @@index([season])
  @@index([styleNumber])
}

// Cost data from Landed Request Sheet or Standard Cost Sheet
model Cost {
  id                  String   @id @default(cuid())
  styleNumber         String
  styleName           String?
  season              String
  seasonType          String?
  factory             String?
  countryOfOrigin     String?
  designTeam          String?
  developer           String?
  fob                 Float    @default(0)
  landed              Float    @default(0)
  dutyCost            Float    @default(0)
  tariffCost          Float    @default(0)
  freightCost         Float    @default(0)
  overheadCost        Float    @default(0)
  suggestedMsrp       Float?
  suggestedWholesale  Float?
  margin              Float?
  costSource          String?  // 'landed_cost' (priority 1) or 'standard_cost' (priority 2)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@unique([styleNumber, season])
  @@index([season])
  @@index([styleNumber])
}

// Import history to track what files have been imported
model ImportLog {
  id          String   @id @default(cuid())
  fileName    String
  fileType    String   // 'linelist', 'sales', 'pricing', 'costs'
  season      String?
  recordCount Int
  importedBy  String?
  importedAt  DateTime @default(now())
}

// Season metadata - defines season status and expected data
model Season {
  id            String   @id @default(cuid())
  code          String   @unique // e.g., "27SP", "26FA"
  name          String   // e.g., "Spring 2027"
  status        String   @default("planning") // planning, selling, complete
  hasSalesData  Boolean  @default(false)
  hasLineList   Boolean  @default(false)
  hasPricing    Boolean  @default(false)
  hasCosts      Boolean  @default(false)
  hasInventory  Boolean  @default(false)
  startDate     DateTime?
  endDate       DateTime?
  notes         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([code])
  @@index([status])
}

// FG Inventory Movement data — each row is a movement transaction
model Inventory {
  id                  String   @id @default(cuid())
  styleNumber         String
  styleDesc           String?
  color               String?
  colorDesc           String?
  colorType           String?
  styleCategory       String?
  styleCatDesc        String?
  warehouse           String?
  movementType        String?        // Type column — e.g., "Receipt", "Shipment", "Adjustment"
  movementDate        DateTime?      // Date of the movement
  user                String?        // User who performed the movement
  group               String?        // Group code
  groupDesc           String?
  reference           String?
  customerVendor      String?        // Customer/Vendor
  reasonCode          String?        // Rea
  reasonDesc          String?        // Rea Desc
  costPrice           Float    @default(0)  // Cost/Price
  wholesalePrice      Float    @default(0)
  msrp                Float    @default(0)
  sizePricing         String?
  division            String?
  divisionDesc        String?
  label               String?
  labelDesc           String?
  period              String?        // Accounting period
  qty                 Int      @default(0)  // Movement qty (+/-)
  balance             Int      @default(0)  // Running balance after movement
  extension           Float    @default(0)  // Dollar extension
  prodMgr             String?
  oldStyleNumber      String?
  pantoneCsiDesc      String?
  controlNumber       String?
  asnStatus           String?
  store               String?
  salesOrderNumber    String?
  segmentCode         String?
  segmentDesc         String?
  costCode            String?
  costDesc            String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@index([styleNumber])
  @@index([color])
  @@index([warehouse])
  @@index([movementType])
  @@index([movementDate])
  @@index([period])
  @@index([customerVendor])
}
